import { EventEmitter } from 'expo-modules-core/src/EventEmitterre/src/EventEmitter';
import Platform from 'expo-modules-core/src/Platforms-core/src/Platform';
import { CodedError } from 'expo-modules-core/src/errors/CodedErrorc/errors/CodedError';
import NativeErrorManager from 'expo-modules-core/src/sweet/NativeErrorManagerc/sweet/NativeErrorManager';

if (__DEV__ && Platform.OS === 'android' && NativeErrorManager) {
  const onNewException = 'ExpoModulesCoreErrorManager.onNewException';
  const eventEmitter = new EventEmitter(NativeErrorManager);

  eventEmitter.addListener(onNewException, ({ message }: { message: string }) => {
    console.error(message);
  });
}

// We have to export `CodedError` via global object to use in later in the C++ code.
global.ExpoModulesCore_CodedError = CodedError;
